<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="SWF dashboard">
    <meta name="author" content="solos::Tec">
    <title>smf :: config gateways</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" type="text/css" href="DataTables/datatables.min.css" />
    <style>
        table.dataTable tbody > tr > td {
            padding-top: 2px;
            padding-bottom: 2px;
        }

        .collapsing {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
        <a class="navbar-brand" href="http://solostec.ch">
            <img src="images/logo.svg" width="30" height="30" class="d-inline-block align-top" alt="">
            solos::Tec
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav mr-auto">

                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                </li>

                <li class="nav-item dropdown active">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Configuration
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="config.device.html">Devices</a>
                        <a class="dropdown-item active" href="config.gateway.html">Gateway</a>
                        <a class="dropdown-item" href="config.meter.html">Meter</a>
                        <a class="dropdown-item" href="config.lora.html">LoRa</a>
                        <a class="dropdown-item" href="config.system.html">System</a>
                        <a class="dropdown-item" href="config.upload.html">Upload</a>
                        <a class="dropdown-item" href="config.download.html">Download</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Status
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="status.session.html">Sessions</a>
                        <a class="dropdown-item" href="status.targets.html">Targets</a>
                        <a class="dropdown-item" href="status.connections.html">Connections</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Monitoring
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="status.system.html">System</a>
                        <a class="dropdown-item" href="monitor.msg.html">Messages</a>
                    </div>
                </li>

            </ul>
            <span id="ws-activity-symbol" style="height: 40px"><svg height="40" width="20"><circle cx="10" cy="20" r="6" stroke="red" stroke-width="0" fill="grey" /></svg></span>
            <span id="ws-activity-text" class="navbar-text">
                connection state
            </span>

        </div>
    </nav>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Gateway Management</h1>
            <hr class="my-4">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="ws-activity-level">0%</div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <table id="smf-table-gw" class="table table-condensed table-striped table-bordered" cellspacing="0">
            <thead>
                <tr>
                    <th class="sml-col-gw-pk">UUID</th>
                    <th class="sml-col-gw-server">Server ID</th>
                    <th class="sml-col-gw-manufacturer">Manufacturer</th>
                    <th class="sml-col-gw-descr">Description</th>
                    <th class="sml-col-gw-name">Name</th>
                    <th class="sml-col-gw-id">Model</th>
                    <th class="sml-col-gw-fw">Firmware</th>
                    <th class="sml-col-gw-user">User</th>
                    <th class="sml-col-gw-pwd">Password</th>
                    <th class="sml-col-gw-online" style="width:10px">&#11156;</th>
                </tr>
            </thead>
        </table>

        <hr />

        <div class="row">
            <div class="col-10">
                <!--                <ul class="nav nav-pills" role="tablist">-->
                <ul class="nav nav-tabs navbar-dark bg-light" role="tablist" id="smf-gw-tab">
                    <li class="nav-item">
                        <a class="nav-link active" id="smf-gw-tab-config" data-toggle="tab" href="#smf-gw-config" aria-selected="true">Configuration</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-status-word" data-toggle="tab" href="#smf-gw-status-word" aria-selected="false">Status</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-srv-visible" data-toggle="tab" href="#smf-gw-srv-visible" aria-selected="false">Visible Meters</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-srv-active" data-toggle="tab" href="#smf-gw-srv-active" aria-selected="false">Active Meters</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-firmware" data-toggle="tab" href="#smf-gw-firmware" aria-selected="false">Firmware</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-memory" data-toggle="tab" href="#smf-gw-memory" aria-selected="false">Memory</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-wireless-mbus" data-toggle="tab" href="#smf-gw-wireless-mbus" aria-selected="false">wireless M-Bus</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" id="smf-gw-tab-ipt" data-toggle="tab" href="#smf-gw-ipt" aria-selected="false">IP-T parameters</a>
                    </li>
                </ul>

                <div class="tab-content bg-secondary" style="min-height:30rem;">
                    <div id="smf-gw-config" class="container-fluid tab-pane fade show active" role="tabpanel">
                        <form id="smf-form-gw" style="padding:2em">
                            <input type="hidden" id="smf-form-gw-tag" name="smf-form-gw-tag" />
                            <input type="hidden" id="smf-form-gw-online" name="smf-form-gw-online" />
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="smf-form-gw-server">Server ID (14 hex. characters)</label>
                                    <input id="smf-form-gw-server" name="smf-form-gw-server" type="text" placeholder="<Server ID>" class="form-control input-md" maxlength="14" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="smf-form-gw-manufacturer">Manufacturer</label>
                                    <input id="smf-form-gw-manufacturer" name="smf-form-gw-manufacturer" type="text" placeholder="<Manufacturer>" class="form-control input-md">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="smf-form-gw-user">User</label>
                                    <input id="smf-form-gw-user" name="smf-form-gw-user" type="text" placeholder="<User>" class="form-control input-md">
                                </div>
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="smf-form-gw-pwd">Password</label>
                                    <input id="smf-form-gw-pwd" name="smf-form-gw-pwd" type="text" placeholder="<Password>" class="form-control input-md">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <a id="smf-form-gw-update" href="#" class="btn btn-info col-md-4 disabled">Update</a>
                                    <label class="control-label" for="smf-form-gw-update">Commit Changes</label>
                                </div>
                                <div class="form-group col-md-6">
                                    <a id="smf-form-gw-delete" href="#" class="btn btn-danger col-md-4 disabled">Delete</a>
                                    <label class="control-label" for="smf-form-gw-delete">Remove <span id="smf-form-gw-delete-name">Device</span></label>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <a id="smf-form-gw-reboot" href="#" class="btn btn-warning col-md-4 disabled">Reboot</a>
                                    <label class="control-label" for="smf-form-gw-reboot">Reboot Device</label>
                                </div>
                                <div class="form-group col-md-6">
                                    <!-- SPACE -->
                                </div>
                            </div>
                        </form>
                    </div>
                    <div id="smf-gw-status-word" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4>Status word</h4>
                        <ul class="list-group"></ul>
                        <br>
                    </div>
                    <div id="smf-gw-srv-visible" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4></h4>
                        <ul class="list-group"></ul>
                        <br>
                    </div>
                    <div id="smf-gw-srv-active" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4></h4>
                        <ul class="list-group"></ul>
                        <br>
                    </div>
                    <div id="smf-gw-firmware" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4></h4>
                        <ul class="list-group"></ul>
                        <br>
                    </div>
                    <div id="smf-gw-memory" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4></h4>
                        <div class="card-deck">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Memory (mirror)</h5>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="smf-gw-memory_progress-1">0%</div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <small class="text-muted"><span id="smf-gw-memory-1">wait...</span>%</small>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Memory (temp)</h5>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="smf-gw-memory_progress-2">0%</div>
                                    </div>
                                    <!--<div id="mem-progress-2"
                                         data-percentage="20"
                                         data-track-width="42"
                                         data-track-colour="555555"
                                         data-fill-colour="00C0FF"
                                         data-text-colour="00C0FF"
                                         data-stroke-colour="FFFFFF"
                                         data-stroke-spacing="4">
                                    </div>-->
                                </div>
                                <div class="card-footer">
                                    <small class="text-muted"><span id="smf-gw-memory-2">wait...</span>%</small>
                                </div>
                            </div>
                        </div>
                        <br>
                    </div>
                    <div id="smf-gw-wireless-mbus" class="container-fluid tab-pane fade" role="tabpanel">
                        <h4>w-MBus</h4>
                        <form id="smf-form-gw-wmbus-param" style="padding:2em">
                            <div class="form-group row">
                                <label for="smf-gw-wmbus-type" class="col-md-2 col-form-label">Adapter Type</label>
                                <div class="col-md-4">
                                    <input id="smf-gw-wmbus-type" name="smf-gw-wmbus-type" placeholder="Manufacturer" type="text" class="form-control here" readonly>
                                </div>
                                <label for="smf-gw-wmbus-adapter" class="col-md-2 col-form-label">Adapter ID</label>
                                <div class="col-md-4">
                                    <input id="smf-gw-wmbus-adapter" name="smf-gw-wmbus-adapter" placeholder="Adapter ID" type="text" class="form-control here" readonly>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="smf-gw-wmbus-firmware" class="col-md-2 col-form-label">Firmware</label>
                                <div class="col-md-4">
                                    <input id="smf-gw-wmbus-firmware" name="smf-gw-wmbus-firmware" placeholder="Firmware Version" type="text" class="form-control here" readonly>
                                </div>
                                <label for="smf-gw-wmbus-hardware" class="col-md-2 col-form-label">Hardware</label>
                                <div class="col-md-4">
                                    <input id="smf-gw-wmbus-hardware" name="smf-gw-wmbus-hardware" placeholder="Hardware Version" type="text" class="form-control here" readonly>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="select" class="col-md-2 col-form-label">Transmission Power</label>
                                <div class="col-md-4">
                                    <select id="smf-gw-wmbus-power" name="smf-gw-wmbus-power" class="custom-select" required="required" aria-describedby="selectHelpBlock">
                                        <option value="0" selected>Basic</option>
                                        <option value="1">Low</option>
                                        <option value="2">Average</option>
                                        <option value="3">Strong</option>
                                    </select>
                                    <!--<span id="selectHelpBlock" class="form-text text-muted">Transmission Power</span>-->
                                </div>
                                <label for="smf-gw-wmbus-reboot" class="col-md-2 col-form-label">Automatic Reboot (sec)</label>
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <!--<div class="input-group-addon">Seconds</div>-->
                                        <input id="smf-gw-wmbus-reboot" name="smf-gw-wmbus-reboot" placeholder="Automatic Reboot in Seconds" type="number" class="form-control here">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-2">Protocol</label>
                                <div class="col-md-4">
                                    <div class="form-check form-check-inline">
                                        <input name="smf-gw-wmbus-protocol" id="smf-gw-wmbus-protocol-tmode" type="radio" class="form-check-input" value="0">
                                        <label class="form-check-label" for="smf-gw-wmbus-protocol-tmode">T-Mode</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input name="smf-gw-wmbus-protocol" is="smf-gw-wmbus-protocol-smode" type="radio" class="form-check-input" value="1">
                                        <label class="form-check-label" for="smf-gw-wmbus-protocol-smode">S-Mode</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input name="smf-gw-wmbus-protocol" id="smf-gw-wmbus-protocol-alternate" type="radio" class="form-check-input" value="2">
                                        <label class="form-check-label" for="smf-gw-wmbus-protocol-alternate">Alternating</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input name="smf-gw-wmbus-protocol" id="smf-gw-wmbus-protocol-parallel" type="radio" class="form-check-input" value="3">
                                        <label class="form-check-label" for="smf-gw-wmbus-protocol-parallel">Parallel</label>
                                    </div>
                                </div>
                                <label class="col-md-2">Install Mode</label>
                                <div class="col-md-4">
                                    <div class="form-check form-check-inline">
                                        <input name="smf-gw-wmbus-install" id="smf-gw-wmbus-install" type="checkbox" class="form-check-input" value="true">
                                        <label class="form-check-label" for="smf-gw-wmbus-install">Active</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row">
                                <div class="offset-2 col-10">
                                    <a id="smf-form-gw-wmbus-submit" href="#" class="btn btn-primary">Submit</a>
<!--                                    <button name="submit" type="submit" class="btn btn-primary">Submit</button>-->
                                </div>
                            </div>
                        </form>
                        <br>
                    </div>
                    <div id="smf-gw-ipt" class="container-fluid tab-pane fade" role="tabpanel">
                        <!--<h4>IP-T</h4>-->
                        <div class="row">
                            <div class="col-md-9">
                                <h5>IP-T Parameters</h5>
                                <form id="smf-form-gw-ipt-param" style="padding:2em">
                                    <h5>Redundancy I</h5>
                                    <input type="hidden" id="smf-form-gw-ipt-srv" name="smf-form-gw-ipt-srv" />
                                    <div class="form-group row">
                                        <label for="smf-gw-ipt-host" class="col-md-1 col-form-label">Host</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-host-1" name="smf-gw-ipt-host-1" placeholder="IP-T Master" type="text" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-local-1" class="col-md-1 col-form-label">Local Port</label>
                                        <div class="col-md-2">
                                            <input id="smf-gw-ipt-local-1" name="smf-gw-ipt-local-1" placeholder="Local Port" type="number" min="0" max="65536" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-remote-1" class="col-md-1 col-form-label">Remote Port</label>
                                        <div class="col-md-2">
                                            <input id="smf-gw-ipt-remote-1" name="smf-gw-ipt-remote-1" placeholder="Remote Port" type="number" min="0" max="65536" class="form-control here">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="smf-gw-ipt-name-1" class="col-md-1 col-form-label">Name</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-name-1" name="smf-gw-ipt-name-1" placeholder="User Name" type="text" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-pwd-1" class="col-md-1 col-form-label">Password</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-pwd-1" name="smf-gw-ipt-pwd-1" placeholder="Password" type="text" class="form-control here">
                                        </div>
                                    </div>
                                    <hr />
                                    <h5>Redundancy II</h5>
                                    <div class="form-group row">
                                        <label for="smf-gw-ipt-host" class="col-md-1 col-form-label">Host</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-host-2" name="smf-gw-ipt-host-2" placeholder="IP-T Master" type="text" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-local-2" class="col-md-1 col-form-label">Local Port</label>
                                        <div class="col-md-2">
                                            <input id="smf-gw-ipt-local-2" name="smf-gw-ipt-local-2" placeholder="Local Port" type="number" min="0" max="65536" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-remote-2" class="col-md-1 col-form-label">Remote Port</label>
                                        <div class="col-md-2">
                                            <input id="smf-gw-ipt-remote-2" name="smf-gw-ipt-remote-2" placeholder="Remote Port" type="number" min="0" max="65536" class="form-control here">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="smf-gw-ipt-name-2" class="col-md-1 col-form-label">Name</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-name-2" name="smf-gw-ipt-name-2" placeholder="User Name" type="text" class="form-control here">
                                        </div>
                                        <label for="smf-gw-ipt-pwd-2" class="col-md-1 col-form-label">Password</label>
                                        <div class="col-md-5">
                                            <input id="smf-gw-ipt-pwd-2" name="smf-gw-ipt-pwd-2" placeholder="Password" type="text" class="form-control here">
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div class="offset-1 col-11">
                                            <a id="smf-form-gw-ipt-submit" href="#" class="btn btn-primary">Submit</a>
                                            <!--                                    <button name="submit" type="submit" class="btn btn-primary" disabled>Submit</button>-->
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-3 bg-warning">
                                <h5>Current IP-T Configuration</h5>
                                <p><span style="font-weight: bold">Note:</span> Changing the IP-T configuration can lead to the breakdown of the connection.</p>
                                <div class="form-group">
                                    <label for="smf-gw-ipt-host" class="col-form-label">Host</label>
                                    <input id="smf-gw-ipt-host" name="smf-gw-ipt-host" placeholder="IP-T Master" type="text" class="form-control here" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="smf-gw-ipt-local" class="col-form-label">Local Port</label>
                                    <input id="smf-gw-ipt-local" name="smf-gw-ipt-local" placeholder="Local Port" type="number" class="form-control here" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="smf-gw-ipt-remote" class="col-form-label">Remote Port</label>
                                    <input id="smf-gw-ipt-remote" name="smf-gw-ipt-remote" placeholder="Remote Port" type="number" class="form-control here" readonly>
                                </div>
                            </div>
                        </div>
                        <!--<br>-->
                    </div>
                </div>
            </div>
            <div class="col-2 bg-warning">
                <div class="form-group">
                    <p><span style="font-weight: bold">Note:</span> No other IP-T connection can be active during the execution of the requests below.</p>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-select-all" name="smf-form-gw-select-all">
                        <label class="form-check-label" for="smf-form-gw-select-all">Select all</label>
                    </div>
                    <hr />
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-status-word" name="smf-form-gw-status-word">
                        <label class="form-check-label" for="smf-form-gw-status-word">Request status word</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-srv-visible" name="smf-form-gw-srv-visible">
                        <label class="form-check-label" for="smf-form-gw-srv-visible">Display visible meters</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-srv-active" name="smf-form-gw-srv-active">
                        <label class="form-check-label" for="smf-form-gw-srv-active">Display active meters</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-firmware" name="smf-form-gw-firmware">
                        <label class="form-check-label" for="smf-form-gw-firmware">Get a firmware list</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-memory" name="smf-form-gw-memory">
                        <label class="form-check-label" for="smf-form-gw-memory">Get memory usage</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-wireless-mbus" name="smf-form-gw-wireless-mbus">
                        <label class="form-check-label" for="smf-form-gw-wireless-mbus">Wireless M-Bus</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" value="" id="smf-form-gw-ipt" name="smf-form-gw-ipt">
                        <label class="form-check-label" for="smf-form-gw-ipt">IP-T</label>
                    </div>
                </div>

            </div>
        </div>  <!--row-->

        <br />
    </div>

    <!-- JavaScript -->
    <script type="text/javascript" src="DataTables/datatables.min.js"></script>
    <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
    <!--<script type="text/javascript" src="popper.min.js"></script>-->

    <script>
        var renderOnlineState = function (data, type, full, meta) {
            if (type == "display") {
                switch (data) {
                    case 1:
                        return "<div style='width: 10px; border: 10px green solid; border-radius: 50%;'></div>";
                    case 2:
                        return "<div style='width: 10px; border: 10px #ffc107 solid; border-radius: 50%;'></div>";
                    default:
                        break;
                }
                return "<div style='width: 10px; border: 10px #ccc solid;'></div>";
            }
            return data;
        };

        //  globals
        var table_gw;
        var _ws = null;
        var totalIO = 0;

        var tbl_config = {
            paging: true,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
            pageLength: 10,
            ordering: true,
            info: true,
            autoWidth: false,
            deferRender: false,
            processing: true,
            searching: true,
            select: true,
            //colReorder: true,
            columnDefs: [
                { targets: 'sml-col-gw-pk', visible: false, name: 'gw-pk' },
                { targets: 'sml-col-gw-server', visible: true, name: 'gw-server' },
                { targets: 'sml-col-gw-manufacturer', visible: true, name: 'gw-manufacturer' },
                { targets: 'sml-col-gw-descr', visible: true, name: 'gw-descr' },
                { targets: 'sml-col-gw-name', visible: true, name: 'gw-name' },
                { targets: 'sml-col-gw-id', visible: true, name: 'gw-id' },
                { targets: 'sml-col-gw-fw', visible: true, name: 'gw-fw' },
                { targets: 'sml-col-gw-user', visible: true, name: 'gw-user' },
                { targets: 'sml-col-gw-pwd', visible: true, name: 'gw-pwd' },
                { targets: 'sml-col-gw-online', visible: true, name: 'gw-online', render: renderOnlineState }
            ]
        };

        $(document).ready(function () {
            console.log('document ready');
            table_gw = $('#smf-table-gw').DataTable(tbl_config);

            table_gw.on('select', function (e, datatable, type, indexes) {

                //  select: a584c1cc-7ae1-455b-99d1-de0f9483520d,05000000000000,solosTec,gateway,ipt:gateway,0.5.2018155,operator,operator,false, length:9
                var rowData = datatable.rows(indexes).data().toArray()[0];
                var rows = table_gw.rows(indexes).data();
                console.log("select: " + rows.toArray() + ", length:" + rowData.length);
                $('#smf-form-legend-gw').text("{" + rowData[0] + "}");
                $('#smf-form-gw-tag').val(rowData[0]);
                $('#smf-form-gw-server').val(rowData[1]);
                $('#smf-form-gw-manufacturer').val(rowData[2]);

                $('#smf-form-gw-user').val(rowData[7]);
                $('#smf-form-gw-pwd').val(rowData[8]);
                $('#smf-form-gw-online').val(rowData[9]);    //  online

                //  enable submit button
                $('#smf-form-gw-update').removeClass('disabled');
                $('#smf-form-gw-delete').removeClass('disabled');
                $('#smf-form-gw-delete-name').html('<abbr title=' + rowData[0] + ' class="font-italic">' + rowData[4] + '</abbr>');

                //  online state
                if (rowData[9]) {
                    $('#smf-form-gw-reboot').removeClass('disabled');
                    $('#smf-form-gw-status-word').removeAttr('disabled');
                    $('#smf-form-gw-srv-visible').removeAttr("disabled");
                    $('#smf-form-gw-srv-active').removeAttr('disabled');
                    $('#smf-form-gw-firmware').removeAttr('disabled');
                    $('#smf-form-gw-memory').removeAttr('disabled');
                    $('#smf-form-gw-wireless-mbus').removeAttr('disabled');
                    $('#smf-form-gw-ipt').removeAttr('disabled');
                }
                else {
                    $('#smf-form-gw-reboot').addClass('disabled');
                    $('#smf-form-gw-status-word').attr("disabled", "disabled");
                    $('#smf-form-gw-srv-visible').attr("disabled", "disabled");
                    $('#smf-form-gw-srv-active').attr("disabled", "disabled");
                    $('#smf-form-gw-firmware').attr("disabled", "disabled");
                    $('#smf-form-gw-memory').attr("disabled", "disabled");
                    $('#smf-form-gw-wireless-mbus').attr("disabled", "disabled");
                    $('#smf-form-gw-ipt').attr("disabled", "disabled");
                }

                $('#smf-form-gw-online').val(rowData[9]);    //  online
                //  gateway is online
                if (rowData[9]) {

                    //$('#smf-nav-item-gw-config').removeClass('disabled');

                    //
                    //  build a vector with all data to request from gateway
                    //
                    var gw_req_vec = [];

                    if ($('#smf-form-gw-status-word').is(":checked")) {
                        $('#smf-gw-status-word ul').empty();
                        $('#smf-gw-status-word h4').text('Status of ' + rowData[1]);
                        gw_req_vec.push("op-log-status-word");
                    }
                    if ($('#smf-form-gw-srv-visible').is(":checked") && rowData[9]) {
                        $('#smf-gw-srv-visible ul').empty();
                        $('#smf-gw-srv-visible h4').text('Visible meters of ' + rowData[1]);
                        gw_req_vec.push("root-visible-devices");
                    }
                    if ($('#smf-form-gw-srv-active').is(":checked") && rowData[9]) {
                        $('#smf-gw-srv-active ul').empty();
                        $('#smf-gw-srv-active h4').text('Active meters of ' + rowData[1]);
                        gw_req_vec.push("root-active-devices");
                    }
                    if ($('#smf-form-gw-firmware').is(":checked") && rowData[9]) {
                        $('#smf-gw-firmware ul').empty();
                        $('#smf-gw-firmware h4').text('Firmware overview ' + rowData[1]);
                        gw_req_vec.push("root-device-id");
                    }
                    if ($('#smf-form-gw-memory').is(":checked") && rowData[9]) {
                        $('#smf-gw-memory ul').empty();
                        $('#smf-gw-memory h4').text('Memory usage ' + rowData[1]);
                        gw_req_vec.push("root-memory-usage");
                    }
                    if ($('#smf-form-gw-wireless-mbus').is(":checked") && rowData[9]) {
                        $('#smf-gw-wireless-mbus h4').text('wireless M-Bus data ' + rowData[1]);
                        gw_req_vec.push("root-wMBus-status");
                        gw_req_vec.push("IF_wMBUS");
                        $('#smf-gw-wmbus-type').attr("placeholder", "waiting...");
                        $('#smf-gw-wmbus-adapter').attr("placeholder", "waiting...");
                        $('#smf-gw-wmbus-firmware').attr("placeholder", "waiting...");
                        $('#smf-gw-wmbus-hardware').attr("placeholder", "waiting...");
                    }
                    if ($('#smf-form-gw-ipt').is(":checked") && rowData[9]) {
                        $('#smf-gw-ipt h4').text('IP-T ' + rowData[1]);
                        $('#smf-form-gw-ipt-srv').val(rowData[1]);  //  hidden variable
                        gw_req_vec.push("root-ipt-state");
                        gw_req_vec.push("root-ipt-param");
                        $('#smf-gw-ipt-host').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-host-1').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-host-2').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-name').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-name-1').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-name-2').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-pwd-1').attr("placeholder", "waiting...");
                        $('#smf-gw-ipt-pwd-2').attr("placeholder", "waiting...");
                    }

                    if (gw_req_vec.length > 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [$('#smf-form-gw-tag').val()], params: [], section: gw_req_vec
                        }));
                    }
                }
                else {
                    //  seems not to work
                    //$('#smf-nav-item-gw-config').addClass('disabled');
                    //$('#smf-nav-item-gw-config').hide();
                }
            });

            function start_ws() {
                //  try connect
                $('#ws-activity-text').html('connecting to ' + location.host + '...');
                _ws = new WebSocket('ws://' + location.host + '/smf/api/gw/v0.1', ['SMF']);

                _ws.onopen = function () {
                    console.log('ws open' + _ws.protocol);
                    //  clear table in case of reconnect
                    table_gw.clear().draw(false);
                    //  subscribe gateway configuration
                    _ws.send(JSON.stringify({ cmd: "subscribe", channel: "config.gateway", push: true }));
                };

                _ws.onclose = function (event) {
                    $('#ws-activity-symbol').show();
                    $('#ws-activity-symbol').find('svg').children().css({ 'fill': 'red' });
                    $('#ws-activity-level').text("out of sync").removeClass('bg-success').addClass('bg-warning');
                    if (event.code == 1006) {
                        $('#ws-activity-text').html('_ws lost - press reload');
                    }
                    else {
                        $('#ws-activity-text').html('error ' + event.code);
                    }
                    check_ws();
                };

                _ws.onerror = function (error) {
                    console.log('ws error');
                    $('#ws-activity-text').html('ws error');
                };

                _ws.onmessage = function (e) {
                    $('#ws-activity-symbol').show();
                    console.log('incoming data: ' + e.data);
                    totalIO += e.data.length;
                    var obj = JSON.parse(e.data);
                    if (obj.cmd != null && obj.channel != null) {
                        if (obj.channel == 'config.gateway') {
                            if (obj.cmd == 'insert') {
                                //
                                // {"cmd": "insert", "channel": "config.gateway", "rec":
                                //  {"key": {"pk":"d28cd24a-980d-46fc-b5ac-8c445415adbf"},
                                //  "data": {"factoryNr":"06441734","serverID":"0500153B02517E","ifData":"00:01:02:03:04:06","ifService":"00:01:02:03:04:05","made":"2018-06-06 13:24:51.38650500","manufacturer":"EMH","mbus":"mbus","model":"MODEL","name":"NAME","online":false,"pwdDef":"secret","pwdRoot":"secret","userName":"operator","userPwd":"operator","vFirmware":"FIRMWARE"}, "gen": 94}}
                                //
                                var server = $('<div/>').text(obj.rec.data.serverId).html();
                                var manufacturer = $('<div/>').text(obj.rec.data.manufacturer).html();
                                var descr = (obj.rec.data.descr != null) ? $('<div/>').text(obj.rec.data.descr).html() : "NO DESCR. AVAILABLE";
                                var name = $('<div/>').text(obj.rec.data.name).html();
                                var model = $('<div/>').text(obj.rec.data.model).html();
                                var firmware = $('<div/>').text(obj.rec.data.vFirmware).html();
                                var userName = $('<div/>').text(obj.rec.data.userName).html();
                                var userPwd = $('<div/>').text(obj.rec.data.userPwd).html();
                                var rowNode = table_gw.row.add([obj.rec.key.pk, server, manufacturer, descr, name, model, firmware, userName, userPwd, obj.rec.data.online]).draw().node();

                            }
                            else if (obj.cmd == 'delete') {
                                //  {"cmd": "delete", "channel": "config.gateway", "key": ["28754043-1f38-4318-a95e-dd9965e80895"]}
                                table_gw.row(function (idx, data, node) {
                                    if (data[0] == obj.key) {
                                        $('#smf-form-gw-delete-name').text("Device");
                                        $('#smf-form-gw-update').addClass('disabled');
                                        $('#smf-form-gw-delete').addClass('disabled');
                                        $('#smf-form-gw-reboot').addClass('disabled');
                                        //$('#smf-form-gw-srv-visible').addClass('disabled');
                                        //$('#smf-form-gw-srv-active').addClass('disabled');

                                        return true;
                                    }
                                    return false;
                                }).remove().draw(false);
                            }
                            else if (obj.cmd == 'modify') {
                                //  {"cmd": "modify", "channel": "config.gateway", "key": ["dca135f3-ff2b-4bf7-8371-a9904c74522b"], "value": {"online":true}}
                                //  {"cmd": "modify", "channel": "config.gateway", "key": ["a584c1cc-7ae1-455b-99d1-de0f9483520d"], "value": {"online":false}}
                                //  {"cmd": "modify", "channel": "config.gateway", "key": ["95e1fd79-21ee-4d58-9dbf-db93f41e3946"], "value": {"descr":"jahsgdjhas"}}
                                table_gw.row(function (idx, data, node) {
                                    if (data[0] == obj.key) {
                                        var r = table_gw.row(node);
                                        var d = r.data();
                                        if (obj.value.online != null) {
                                            d[9] = obj.value.online;
                                        }
                                        else if (obj.value.serverId != null) {
                                            d[1] = obj.value.serverId;
                                        }
                                        else if (obj.value.manufacturer != null) {
                                            d[2] = obj.value.manufacturer;
                                        }
                                        else if (obj.value.descr != null) {
                                            d[3] = obj.value.descr;
                                        }
                                        else if (obj.value.name != null) {
                                            d[4] = obj.value.name;
                                        }
                                        else if (obj.value.userName != null) {
                                            d[7] = obj.value.userName;
                                        }
                                        else if (obj.value.userPwd != null) {
                                            d[8] = obj.value.userPwd;
                                        }
                                        r.data(d);
                                        $('#smf-form-gw-delete').addClass('disabled');
                                        return true;
                                    }
                                    return false;
                                });
                            }
                            else if (obj.cmd == 'clear') {
                                table_gw.clear().draw(false);
                            }
                            else if (obj.cmd == 'load') {
                                //  load status
                                if (obj.show != null) {
                                    if (obj.show) {
                                        $('#ws-activity-symbol').find('svg').children().css({ 'fill': 'orange' });
                                        $('#ws-activity-symbol').show();
                                        $('#ws-activity-level').css("width", "0%").text("0%").removeClass('bg-warning').addClass('bg-info');
                                    }
                                    else {
                                        $('#ws-activity-symbol').find('svg').children().css({ 'fill': 'green' });
                                        $('#ws-activity-symbol').fadeOut();
                                        $('#ws-activity-level').css("width", "100%").text("synchronized").removeClass('bg-info').addClass('bg-success');
                                        table_gw.order([4, 'asc']).draw();
                                    }
                                }
                                else if (obj.level != null) {
                                    console.log('progess: ' + obj.level + "%");
                                    $('#ws-activity-level').css("width", obj.level + "%").attr("aria-valuenow", obj.level).text(obj.level + "%");
                                }
                            }
                        }
                        else if (obj.section == 'op-log-status-word') {
                            //  {"cmd": "update", "channel": "status.gateway.word", "rec": {"srv": "00:ff:b0:0b:ca:ae", "word": {"256":false,"8192":true,"16384":false,"65536":true,"131072":true,"262144":true,"524288":false,"4294967296":false}}}
                            //  {"cmd": "update", "channel": "op-log-status-word", "rec": {"srv": "00:15:3b:02:17:74", "values": {"word":{"STATUS_BIT_AUTHORIZED_IPT":false,"STATUS_BIT_EXT_IF_AVAILABLE":true,"STATUS_BIT_FATAL_ERROR":false,"STATUS_BIT_MBUS_IF_AVAILABLE":false,"STATUS_BIT_NO_TIMEBASE":false,"STATUS_BIT_OUT_OF_MEMORY":false,"STATUS_BIT_PLC_AVAILABLE":false,"STATUS_BIT_SERVICE_IF_AVAILABLE":false}}}}
                            //  {"cmd": "update", "section": "op-log-status-word", "rec": {"srv": "00:15:3b:02:29:7e", "values": {"word":{"AUTHORIZED_IPT":false,"EXT_IF_AVAILABLE":true,"FATAL_ERROR":false,"MBUS_IF_AVAILABLE":false,"NO_TIMEBASE":false,"OUT_OF_MEMORY":false,"PLC_AVAILABLE":false,"SERVICE_IF_AVAILABLE":false}}}}
                            if (obj.cmd == 'update') {
                                //console.log("word." + prop + " = " + obj.rec.word[prop]);
                                if (obj.rec.values.word.FATAL_ERROR) {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-danger">fatal error</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">no error</li>');
                                }
                                if (obj.rec.values.word.AUTHORIZED_IPT) {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">online</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">offline</li>');
                                }

                                if (obj.rec.values.word.OUT_OF_MEMORY)   {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-danger">out of memory</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">no memory shortage</li>');
                                }
                                if (obj.rec.values.word.SERVICE_IF_AVAILABLE)    {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">customer interface available</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">no customer interface</li>');
                                }
                                if (obj.rec.values.word.EXT_IF_AVAILABLE)    {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">extension interface available</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">no extension interface</li>');
                                }
                                if (obj.rec.values.word.MBUS_IF_AVAILABLE)    {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">wireless M-bus</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">no wireless M-bus available</li>');
                                }
                                if (obj.rec.values.word.PLC_AVAILABLE)    {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">PLC interface available</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-secondary">no PLC interface</li>');
                                }
                                if (obj.rec.values.word.NO_TIMEBASE) {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-warning">uncertain timebase</li>');
                                }
                                else {
                                    $('#smf-gw-status-word ul').append('<li class="list-group-item list-group-item-success">NTP is running</li>');
                                }
                            }
                        }
                        else if (obj.section == 'root-visible-devices') {
                            //  {"cmd": "update", "channel": "root-visible-devices", "rec": {"srv": "00:15:3b:02:17:74", "values": {"class":"---","meter":"000000000000","number":"1","timestamp":"2018-11-04 20:34:28.00000000","type":9}}}
                            if (obj.cmd == 'update') {
                                if (obj.rec.values.type == 0) {
                                    $('#smf-gw-srv-visible ul').append('<li class="list-group-item list-group-item-success">#'
                                        + obj.rec.values.number
                                        + ' '
                                        + obj.rec.values.meter
                                        + ' ('
                                        + obj.rec.values.timestamp
                                        + ')</li>');
                                }
                                else {
                                    $('#smf-gw-srv-visible ul').append('<li class="list-group-item list-group-item-secondary">#'
                                        + obj.rec.values.number
                                        + ' '
                                        + obj.rec.values.meter
                                        + ' ('
                                        + obj.rec.values.timestamp
                                        + ')</li>');
                                }
                            }
                        }
                        else if (obj.section == 'root-active-devices') {
                            //  {"cmd": "update", "channel": "root-active-devices", "rec": {"srv": "00:15:3b:01:ec:46", "values": {"class":"---","meter":"01-fa30-6dd7fae0-01-02","number":"10","timestamp":"2016-08-03 09:26:06.00000000","type":0}}}
                            if (obj.cmd == 'update') {
                                if (obj.rec.values.type == 0) {
                                    $('#smf-gw-srv-active ul').append('<li class="list-group-item list-group-item-success">#'
                                    + obj.rec.values.number
                                    + ' '
                                    + obj.rec.values.meter
                                    + ' ('
                                    + obj.rec.values.timestamp
                                    + ')</li>');
                                }
                                else {
                                    $('#smf-gw-srv-active ul').append('<li class="list-group-item list-group-item-secondary">#'
                                    + obj.rec.values.number
                                    + ' '
                                    + obj.rec.values.meter
                                    + ' ('
                                    + obj.rec.values.timestamp
                                    + ')</li>');
                                }
                            }
                        }
                        else if (obj.section == 'root-device-id') {
                            //  {"cmd": "update", "channel": "root-device-id", "rec": {"srv": "00:15:3b:02:29:7e", "values": {"active":false,"firmware":"FACTORY VERSION","number":2,"version":"VSES-1.11_11132000__X025b"}}}
                            if (obj.cmd == 'update') {
                                if (obj.rec.values.active) {
                                    $('#smf-gw-firmware ul').append('<li class="list-group-item list-group-item-success">#'
                                        + obj.rec.values.number
                                        + ' '
                                        + obj.rec.values.firmware
                                        + ': '
                                        + obj.rec.values.version
                                        + '</li>');
                                }
                                else {
                                    $('#smf-gw-firmware ul').append('<li class="list-group-item list-group-item-secondary">#'
                                        + obj.rec.values.number
                                        + ' '
                                        + obj.rec.values.firmware
                                        + ': '
                                        + obj.rec.values.version
                                        + '</li>');
                                }
                            }
                        }
                        else if (obj.section == 'root-memory-usage') {
                            //{"cmd": "update", "channel": "root-memory-usage", "rec": {"srv": "00:15:3b:02:17:74", "values": {"memory.mirror":22,"memory.tmp":0}}}
                            $('#smf-gw-memory-1').text(obj.rec.values.mirror);
                            $('#smf-gw-memory-2').text(obj.rec.values.tmp);
                            $('#smf-gw-memory_progress-1').css("width", obj.rec.values.mirror + "%").attr("aria-valuenow", obj.rec.values.mirror).text(obj.rec.values.mirror + "%");
                            $('#smf-gw-memory_progress-2').css("width", obj.rec.values.tmp + "%").attr("aria-valuenow", obj.rec.values.tmp).text(obj.rec.values.tmp + "%");
                            if (obj.rec.values.mirror > 60) {
                                $('#smf-gw-memory_progress-1').removeClass('bg-success');
                                $('#smf-gw-memory_progress-1').addClass('bg-warning');
                            }
                            else {
                                $('#smf-gw-memory_progress-1').removeClass('bg-warning');
                                $('#smf-gw-memory_progress-1').addClass('bg-success');
                            }
                        }
                        else if (obj.section == 'root-wMBus-status') {
                            // {"cmd": "update", "channel": "root-wMBus-status", "rec": {"srv": "00:ff:b0:0b:ca:ae", "values": {"firmware":"0.6.2018309","hardware":"2.00","id":"a815348340040131","manufacturer":"solos::Tec"}}}
                            $('#smf-gw-wmbus-type').val(obj.rec.values.manufacturer);
                            $('#smf-gw-wmbus-adapter').val(obj.rec.values.id);
                            $('#smf-gw-wmbus-firmware').val(obj.rec.values.firmware);
                            $('#smf-gw-wmbus-hardware').val(obj.rec.values.hardware);

                        }
                        else if (obj.section == 'IF_wMBUS') {
                            // {"cmd": "update", "channel": "IF_wMBUS", "rec": {"srv": "00:15:3b:02:23:b3", "values": {"installMode":0,"power":0,"protocol":0,"reboot":86400,"s-mode":30,"t-mode":20}}}
                            $('#smf-gw-wmbus-power').val(obj.rec.values.power);
                            $('#smf-gw-wmbus-reboot').val(obj.rec.values.reboot);
                            switch (obj.rec.values.protocol) {
                                case 0: $('#smf-gw-wmbus-protocol-tmode').prop("checked", true); break;
                                case 1: $('#smf-gw-wmbus-protocol-smode').prop("checked", true); break;
                                case 2: $('#smf-gw-wmbus-protocol-alternate').prop("checked", true); break;
                                case 3: $('#smf-gw-wmbus-protocol-parallel').prop("checked", true); break;
                                default: break;
                            }
                            $('#smf-gw-wmbus-install').prop("checked", obj.rec.values.installMode != 0);
                            //$('#smf-gw-wmbus-install').prop("checked", true);

                        }
                        else if (obj.section == 'root-ipt-state') {
                            //  {"cmd": "update", "channel": "root-ipt-state", "rec": {"srv": "00:15:3b:02:29:7e", "values": {"address":"192.168.1.21","local":26862,"remote":3653}}}
                            $('#smf-gw-ipt-host').val(obj.rec.values.address);
                            $('#smf-gw-ipt-local').val(obj.rec.values.local);
                            $('#smf-gw-ipt-remote').val(obj.rec.values.remote);
                        }
                        else if (obj.section == 'root-ipt-param') {
                            // {"cmd": "update", "channel": "root-ipt-param", "rec": {"srv": "00:15:3b:02:29:7e", "values": {"address":"0.0.0.0","idx":1,"local":26862,"name":0,"pwd":0,"remote":0}}}
                            //$('#smf-form-gw-ipt-srv').val(obj.rec.srv);
                            if (obj.rec.values.idx == 1) {

                                $('#smf-gw-ipt-host-1').val(obj.rec.values.address);
                                $('#smf-gw-ipt-local-1').val(obj.rec.values.local);
                                $('#smf-gw-ipt-remote-1').val(obj.rec.values.remote);
                                $('#smf-gw-ipt-name-1').val(obj.rec.values.name);
                                $('#smf-gw-ipt-pwd-1').val(obj.rec.values.pwd);
                            }
                            else {

                                $('#smf-gw-ipt-host-2').val(obj.rec.values.address);
                                $('#smf-gw-ipt-local-2').val(obj.rec.values.local);
                                $('#smf-gw-ipt-remote-2').val(obj.rec.values.remote);
                                $('#smf-gw-ipt-name-2').val(obj.rec.values.name);
                                $('#smf-gw-ipt-pwd-2').val(obj.rec.values.pwd);
                            }
                        }
                    }
                    $('#ws-activity-text').html(format_bytes(totalIO) + ' received');
                    $('#ws-activity-symbol').fadeOut();
                };
            }

            function check_ws() {
                if (!_ws || _ws.readyState == 3) {
                    start_ws();
                }
            }

            start_ws();

            setInterval(check_ws, 5000);

            $('#smf-form-gw-delete').on("click", function (event) {
                event.preventDefault();
                var key = $('#smf-form-gw-tag').val();
                console.log($(this).text() + ' ' + key);
                _ws.send(JSON.stringify({
                    cmd: 'delete', channel: 'config.gateway', key: {
                        tag: [key]
                    }
                }));
            });

            $('#smf-form-gw-update').on("click", function (event) {
                event.preventDefault();
                console.log('update: ' + $('#smf-form-gw').serialize());

                _ws.send(JSON.stringify({
                    cmd: "modify", channel: "config.gateway", rec: {
                        key: [$('#smf-form-gw-tag').val()],
                        data: {
                            serverId: $('#smf-form-gw-server').val(),
                            manufacturer: $('#smf-form-gw-manufacturer').val(),
                            userName: $('#smf-form-gw-user').val(),
                            userPwd: $('#smf-form-gw-pwd').val()
                        }
                    }
                }));
            });

            $('#smf-form-gw-reboot').on("click", function (event) {
                event.preventDefault();
                console.log('reboot: ' + $('#smf-form-gw').serialize());

                _ws.send(JSON.stringify({
                    cmd: "config:gateway", channel: "set.proc.param", key: [$('#smf-form-gw-tag').val()], params: [], section: ["reboot"]
                }));
            });

            $('#smf-form-gw-ipt-submit').on("click", function (event) {
                event.preventDefault();
                //  smf-gw-ipt-host-1=192.168.1.21&smf-gw-ipt-local-1=26862&smf-gw-ipt-remote-1=0&smf-gw-ipt-name-1=LSMTest5&smf-gw-ipt-pwd-1=LSMTest5&smf-gw-ipt-host-2=192.168.1.21&smf-gw-ipt-local-2=26863&smf-gw-ipt-remote-2=0&smf-gw-ipt-name-2=wretwert&smf-gw-ipt-pwd-2=LSMTest5
                //console.log('modify ipt: ' + $('#smf-form-gw-ipt-param').serialize());
                var formData = JSON.parse(JSON.stringify(jQuery('#smf-form-gw-ipt-param').serializeArray())) // store json object

                _ws.send(JSON.stringify({
                    cmd: "config:gateway", channel: "set.proc.param", key: [$('#smf-form-gw-tag').val()], params: formData, section: ["ipt"]
                }));
            });

            $('#smf-form-gw-wmbus-submit').on("click", function (event) {
                event.preventDefault();
                //console.log('modify wmbus: ' + $('#smf-form-gw-wmbus-param').serialize());
                //console.log(jQuery('#smf-form-gw-wmbus-param').serializeArray());
                var formArray = jQuery('#smf-form-gw-wmbus-param').serializeArray();

                var idActive = formArray.find(function (elem) {
                    if (elem.name == "smf-gw-wmbus-install") {
                        elem.value = true;
                        return true;
                    }
                    return false;
                });
                if (idActive == null) {
                    formArray.push({ name: "smf-gw-wmbus-install", value: false });
                }
            
                var formData = JSON.parse(JSON.stringify(formArray)); // store json object
                
                _ws.send(JSON.stringify({
                    cmd: "config:gateway", channel: "set.proc.param", key: [$('#smf-form-gw-tag').val()], params: formData, section: ["wmbus"]
                }));
            });

            $('#smf-form-gw-select-all').change(function () {
                select_all_tabs(this.checked);
            });

            $('#smf-form-gw-status-word').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-status-word').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["op-log-status-word"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-status-word').addClass('disabled');
                }
            });

            $('#smf-form-gw-srv-visible').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-srv-visible').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-visible-devices"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-srv-visible').addClass('disabled');
                }
            });

            $('#smf-form-gw-srv-active').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-srv-active').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-active-devices"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-srv-active').addClass('disabled');
                }
            });

            $('#smf-form-gw-firmware').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-firmware').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-device-id"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-firmware').addClass('disabled');
                }
            });

            $('#smf-form-gw-memory').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-memory').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-memory-usage"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-memory').addClass('disabled');
                }
            });

            $('#smf-form-gw-wireless-mbus').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-wireless-mbus').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-wMBus-status", "IF_wMBUS"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-wireless-mbus').addClass('disabled');
                }
            });

            $('#smf-form-gw-ipt').change(function () {
                if (this.checked) {
                    $('#smf-gw-tab-ipt').removeClass('disabled');
                    var data = table_gw.rows({ selected: true }).data();
                    if (data.length != 0) {
                        _ws.send(JSON.stringify({
                            cmd: "config:gateway", channel: "get.proc.param", key: [data[0][0]], params: [], section: ["root-ipt-state", "root-ipt-param"]
                        }));
                    }
                }
                else {
                    $('#smf-gw-tab-ipt').addClass('disabled');
                }
            });

            //var g_1 = d3.select("mem-progress-1").append("svg").append('g').attr('transform', 'translate(' + boxSize / 2 + ',' + boxSize / 2 + ')');
            //var g_2 = d3.select("mem-progress-2").append("svg").append('g').attr('transform', 'translate(' + boxSize / 2 + ',' + boxSize / 2 + ')');

            //g_1.append('g').attr('style', 'background-color:cadetblue;');
            //var dim = d3.select("#mem-progress-1").node().getBoundingClientRect();
            //alert(dim);
            //d3.select("#mem-progress-1").style('background-color', 'cadetblue');

        }); //  document ready


        function select_all_tabs(b) {
            $('#smf-form-gw-status-word').prop("checked", b).change();
            $('#smf-form-gw-srv-visible').prop("checked", b).change();
            $('#smf-form-gw-srv-active').prop("checked", b).change();
            $('#smf-form-gw-firmware').prop("checked", b).change();
            $('#smf-form-gw-memory').prop("checked", b).change();
            $('#smf-form-gw-wireless-mbus').prop("checked", b).change();
            $('#smf-form-gw-ipt').prop("checked", b).change();
        }

    </script>

    <script>
            const units = ['bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            function format_bytes(x) {

                let l = 0, n = parseInt(x, 10) || 0;
                while (n >= 1024 && ++l) {
                    n = n / 1024;
                }

                if (n == 0) return '-';
                return (n.toFixed(l < 1 ? 0 : 1) + ' ' + units[l]);
            }
    </script>

</body>
</html>
